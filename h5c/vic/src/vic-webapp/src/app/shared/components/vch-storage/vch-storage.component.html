<!-- Read Only content -->
<div *ngIf="readOnly; else formContent">
  <clr-stack-view class="mt-2">
    <clr-stack-block>
      <clr-stack-label>{{ i18n.translate('vch.storage.imageDataStore') }}</clr-stack-label>
      <clr-stack-content>{{model.imageStore}}</clr-stack-content>
    </clr-stack-block>
    <clr-stack-block>
      <clr-stack-label>{{ i18n.translate('vch.storage.fileFolder') }}</clr-stack-label>
      <clr-stack-content>{{model.fileFolder}}</clr-stack-content>
    </clr-stack-block>
    <clr-stack-block>
      <clr-stack-label>{{ i18n.translate('vch.storage.maxContainerVmImageSize') }}</clr-stack-label>
      <clr-stack-content>{{model.baseImageSize || '-'}} {{model.baseImageSizeUnit || 'GiB / MiB'}}</clr-stack-content>
    </clr-stack-block>
  </clr-stack-view>

  <h4>{{ i18n.translate('vch.storage.volumeDatastores') }}</h4>
  <clr-datagrid>
    <clr-dg-column>{{ i18n.translate('vch.storage.datastore') }}</clr-dg-column>
    <clr-dg-column>{{ i18n.translate('vch.storage.folder') }}</clr-dg-column>
    <clr-dg-column>{{ i18n.translate('vch.storage.volumeStoreName') }}</clr-dg-column>

    <clr-dg-row *clrDgItems="let vol of model.volumeStore">
      <clr-dg-cell>{{vol.volDatastore}}</clr-dg-cell>
      <clr-dg-cell>{{vol.volFileFolder}}</clr-dg-cell>
      <clr-dg-cell>{{vol.dockerVolName}}</clr-dg-cell>
    </clr-dg-row>

    <clr-dg-footer>
      <clr-dg-pagination #pagination [clrDgPageSize]="10">
        {{pagination.firstItem + 1}} - {{pagination.lastItem + 1}}
        {{ i18n.translate('vch.storage.of') }} {{pagination.totalItems}} {{ i18n.translate('vch.storage.volumes') }}
      </clr-dg-pagination>
    </clr-dg-footer>
  </clr-datagrid>
</div>

<!-- Form content -->
<ng-template #formContent>

  <div class="spinner" *ngIf="datastoresLoading"></div>

  <form class="pt-0" [formGroup]="form" novalidate *ngIf="!datastoresLoading">
    <section class="form-block my-0"  id='storage-capacity'>

      <label>
        {{ i18n.translate('vch.storage.imageDataStore') }}
      </label>

      <p class="mt-0 mb-2">
        {{ i18n.translate('vch.storage.subTitle') }}
      </p>

      <div class="form-group row">
        <div class="col-xs-3">

          <label class="required" for="image-store-selector">
            {{ i18n.translate('vch.storage.datastore') }}
          </label>

        </div>
        <div class="col-xs-4">

          <div class="select form-control">
            <select id="image-store-selector" formControlName="imageStore">
              <option value="">{{ i18n.translate('vch.storage.notSelected') }}</option>
              <option [value]="datastore.name" *ngFor="let datastore of datastores; trackBy: datastoreTrackByFn">
                {{ datastore.name }} ({{ datastore?.info?.freeSpace }} {{ i18n.translate('vch.storage.free') }})
              </option>
            </select>
          </div>

        </div>
      </div>

      <div class="form-group row">
        <div class="col-xs-3">

          <label for="file-folder-selector">
            {{ i18n.translate('vch.storage.fileFolder') }}
          </label>

        </div>
        <div class="col-xs-4">

          <input id="file-folder-selector"
                 class="form-control"
                 type="text"
                 placeholder="Existing or new folder name"
                 formControlName="fileFolder">

        </div>
      </div>

      <div class="form-group row">
        <div class="col-xs-3">

          <label class="image-size-label">
            {{ i18n.translate('vch.storage.maxContainerVm') }}<br>
            {{ i18n.translate('vch.storage.imageSize') }}
          </label>

        </div>
        <div class="col-xs-2">

          <label for="base-image-size"
                 aria-haspopup="true"
                 role="tooltip"
                 class="form-control tooltip tooltip-validation tooltip-md tooltip-top-right"
                 [class.invalid]="form.get('baseImageSize').invalid && (form.get('baseImageSize').dirty || form.get('baseImageSize').touched)">

            <input type="text"
                   id="base-image-size"
                   formControlName="baseImageSize"
                   class="form-control">

            <span class="tooltip-content" *ngIf="form.get('baseImageSize').hasError('required')">
              {{ i18n.translate('vch.storage.imageSizeEmptyTooltip') }}
          </span>

            <span class="tooltip-content" *ngIf="form.get('baseImageSize').hasError('pattern')">
              {{ i18n.translate('vch.storage.imageSizeNumericTooltip') }}
          </span>

            <small class="text-muted text-nowrap">
              {{ i18n.translate('vch.storage.limitInfo') }}
            </small>

          </label>

        </div>
        <div class="col-xs-2">

          <div class="select form-control">
            <select formControlName="baseImageSizeUnit">
              <option value="MiB">MB</option>
              <option selected value="GiB">GB</option>
            </select>
          </div>

        </div>

        <clr-signpost>
          <clr-signpost-content [clrPosition]="'top-left'" *clrIfOpen>
          <span>
            {{ i18n.translate('vch.storage.imageSizeInfo') }}
          </span>
          </clr-signpost-content>
        </clr-signpost>

      </div>

    </section>

    <section class="form-block">

      <label>
        {{ i18n.translate('vch.storage.volumeDatastores') }}
      </label>

      <p class="mt-0">
        {{ i18n.translate('vch.storage.volumeDatastoresSubtitle') }}
      </p>

      <div class="form-group row mb-2">
        <div class="col-xs">
          <div class="toggle-switch">
            <input type="checkbox" id="enable-anonymous-volumes" formControlName="enableAnonymousVolumes">
            <label for="enable-anonymous-volumes">{{ i18n.translate('vch.storage.enableAnonymousVolumes') }}</label>
          </div>
        </div>
      </div>

      <div class="mb-1" formArrayName="volumeStore">

        <div class="form-group row mb-0"
             [formGroupName]="i"
             *ngFor="let volumeStoreItem of form.controls.volumeStore.controls; let i=index">
          <div class="col-xs-3">

            <label [ngClass]="{'required': form.get('enableAnonymousVolumes').value && i === 0}">
              {{ i18n.translate('vch.storage.volumeDatastore') }}
            </label>

          </div>
          <div class="col-xs-3">

            <small class="vol-datastore-header" *ngIf="i === 0">{{ i18n.translate('vch.storage.datastore') }}</small>
            <div class="select form-control">
              <select formControlName="volDatastore">
                <option value="">{{ i18n.translate('vch.storage.notSelected') }}</option>
                <option [value]="datastore.name" *ngFor="let datastore of datastores">
                  {{ datastore.name }} ({{ datastore?.info?.freeSpace }} {{ i18n.translate('vch.storage.free') }})
                </option>
              </select>
            </div>

          </div>
          <div class="col-xs-3">

            <small class="vol-datastore-header" *ngIf="i === 0">{{ i18n.translate('vch.storage.folder') }}</small>
            <input class="form-control"
                   type="text"
                   placeholder="Optional folder name"
                   formControlName="volFileFolder">

          </div>
          <div class="col-xs">

            <small class="vol-datastore-header" *ngIf="i === 0">{{ i18n.translate('vch.storage.volumeStoreName') }}</small>
            <label class="form-control tooltip tooltip-validation tooltip-md tooltip-top-left"
                   for="docker-volname-selector"
                   aria-haspopup="true"
                   role="tooltip"
                   [class.invalid]="form.get('volumeStore').controls[i].invalid && (form.get('volumeStore').controls[i].dirty || form.get('volumeStore').controls[i].touched)"
                   *ngIf="(form.get('enableAnonymousVolumes').value && i > 0) || (!form.get('enableAnonymousVolumes').value)">

              <input id="docker-volname-selector"
                     class="form-control"
                     type="text"
                     placeholder="Volume name"
                     formControlName="dockerVolName">

              <span class="tooltip-content" *ngIf="form.get('volumeStore').controls[i].controls['dockerVolName'].hasError('required')">
              {{ i18n.translate('vch.storage.dockerVolNameEmptyTooltip') }}
            </span>

              <span class="tooltip-content" *ngIf="form.get('volumeStore').controls[i].controls['dockerVolName'].hasError('pattern')">
              {{ i18n.translate('vch.storage.dockerVolNameCharsTooltip') }}
            </span>

            </label>

            <span *ngIf="form.get('enableAnonymousVolumes').value && i === 0">{{dockerVolNameDefault}}</span>

          </div>
          <div class="col-xs-1 px-0 vol-datastore-actions">

            <clr-icon class="is-solid"
                      shape="times-circle"
                      (click)="removeVolumeDatastoreEntry(i)"
                      *ngIf="(form.get('enableAnonymousVolumes').value && i > 1) || (!form.get('enableAnonymousVolumes').value && i > 0)">
            </clr-icon>
            <clr-icon class="is-solid"
                      shape="plus-circle"
                      (click)="addNewVolumeDatastoreEntry()"
                      *ngIf="i === form.controls.volumeStore.controls.length - 1">
            </clr-icon>

          </div>
        </div>
      </div>

    </section>
  </form>


</ng-template>
